<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Waste Management Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script>
      // Make sure Tailwind config is available for JS if needed, and for CDN JIT
      window.tailwind = {
        config: {
          theme: {
            extend: {
              fontFamily: {
                sans: ['Inter', 'system-ui', 'sans-serif'],
              },
              colors: {
                primary: { DEFAULT: '#3B82F6', dark: '#2563EB' },
                secondary: { DEFAULT: '#6B7280', light: '#D1D5DB', dark: '#4B5563', darker: '#374151', lightest: '#F9FAFB' }, // Added darkest here from previous step, but it's not in current config. Correcting to use defined ones.
                success: { DEFAULT: '#10B981', dark: '#059669' },
                error: { DEFAULT: '#EF4444', dark: '#DC2626' },
                warning: { DEFAULT: '#F59E0B', dark: '#D97706' },
                info: { DEFAULT: '#6366F1', dark: '#4F46E5' },
              },
              animation: { fadeIn: 'fadeIn 0.5s ease-out forwards' },
              keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
            },
          },
          variants: { extend: {} },
          plugins: [],
        }
      };
    </script>
    <style>
        .fill-bar {
            transition: width 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }
    </style>
</head>
<body class="font-sans bg-secondary-light text-secondary-darker p-5 animate-fadeIn opacity-0">
    <div class="container mx-auto max-w-6xl">
        <h1 class="text-primary-dark text-3xl font-bold text-center mb-8">Smart Waste Management Dashboard</h1>

        <!-- Bins Section -->
        <div class="section-card bg-white p-6 mb-8 rounded-lg shadow-lg">
            <div class="section-header flex justify-between items-center mb-6">
                <h2 class="text-primary text-2xl font-semibold">Bins Overview</h2>
                <button id="refresh-bins" class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-4 rounded-md shadow-sm transition-all duration-150 ease-in-out active:scale-95 disabled:bg-secondary-light disabled:text-secondary disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">Refresh Bins</button>
            </div>
            <div id="bins-table-container" class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="bin_id">Bin ID <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest">Location (Lat, Lon)</th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="current_fill_level_gallons">Fill Level (Gal) <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest">Capacity (Gal)</th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="fill_percentage">Fill (%) <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="status">Status <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="last_updated">Last Updated <span class="sort-indicator text-primary ml-1"></span></th>
                        </tr>
                    </thead>
                    <tbody id="bins-table-body" class="text-sm">
                    </tbody>
                </table>
                <div id="bins-loading" class="py-4 text-center text-primary" style="display:none;">
                    <svg class="animate-spin h-5 w-5 text-primary inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    Loading bins...
                </div>
            </div>
        </div>

        <div class="section-card bg-white p-6 mb-8 rounded-lg shadow-lg">
            <div class="section-header flex justify-between items-center mb-6">
                <h2 class="text-primary text-2xl font-semibold">Routes Overview</h2>
                <button id="refresh-routes" class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-4 rounded-md shadow-sm transition-all duration-150 ease-in-out active:scale-95 disabled:bg-secondary-light disabled:text-secondary disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">Refresh Routes</button>
            </div>
            <div id="routes-table-container" class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="route_id">Route ID <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="assigned_truck_id">Truck ID <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="status">Status <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest">Bins to Collect</th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest cursor-pointer whitespace-nowrap" data-sort-key="generated_at">Generated At <span class="sort-indicator text-primary ml-1"></span></th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest">Started At</th>
                            <th class="p-3 text-left text-xs font-semibold text-secondary-darker uppercase tracking-wider border-b border-secondary-light bg-secondary-lightest">Completed At</th>
                        </tr>
                    </thead>
                    <tbody id="routes-table-body" class="text-sm">
                    </tbody>
                </table>
                 <div id="routes-loading" class="py-4 text-center text-primary" style="display:none;">
                    <svg class="animate-spin h-5 w-5 text-primary inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    Loading routes...
                </div>
            </div>
        </div>

        <div class="section-card bg-white p-6 mb-8 rounded-lg shadow-lg">
            <div class="section-header mb-6">
                <h2 class="text-primary text-2xl font-semibold">Generate New Route</h2>
            </div>
            <div class="generate-route-controls flex items-center gap-4 mb-4">
                <label for="truck-id" class="text-secondary-dark font-semibold">Truck ID:</label>
                <input type="text" id="truck-id" value="truck001" placeholder="Enter Truck ID" class="p-2 border border-secondary-light rounded-md shadow-sm focus:ring-primary focus:border-primary focus:ring-opacity-50 transition-all duration-150 ease-in-out flex-grow sm:flex-grow-0">
                <button id="generate-route" class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-4 rounded-md shadow-sm transition-all duration-150 ease-in-out active:scale-95 disabled:bg-secondary-light disabled:text-secondary disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50">
                    <span id="generate-route-btn-text">Generate Route</span>
                </button>
            </div>
            <div id="generate-route-message" class="p-4 rounded-md mt-4 text-sm" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Ensure body opacity is set for fadeIn animation after DOM content is loaded
        document.addEventListener('DOMContentLoaded', () => {
            document.body.classList.remove('opacity-0');
            initialLoad();
            document.getElementById('refresh-bins').addEventListener('click', fetchBinsAndRender);
            document.getElementById('refresh-routes').addEventListener('click', fetchRoutesAndRender);
            generateRouteButton.addEventListener('click', handleGenerateRoute);
            setupSortableTableHeaders();
        });

        let allBins = [];
        let allRoutes = [];
        let currentBinSortKey = 'last_updated';
        let currentBinSortDirection = 'desc';
        let currentRouteSortKey = 'generated_at';
        let currentRouteSortDirection = 'desc';

        const successIconSVG = `<svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`;
        const errorIconSVG = `<svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v4a1 1 0 102 0V5zm-1 6a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd"></path></svg>`;
        const infoIconSVG = `<svg class="w-5 h-5 inline-block mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>`;
        const loadingSpinnerSVG = `<svg class="animate-spin h-5 w-5 text-white inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
        const emptyIconSVG = `<svg class="w-12 h-12 text-secondary-light mx-auto mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" /></svg>`;

        const binsTableBody = document.getElementById('bins-table-body');
        const routesTableBody = document.getElementById('routes-table-body');
        const binsLoadingDiv = document.getElementById('bins-loading');
        const routesLoadingDiv = document.getElementById('routes-loading');
        const generateRouteButton = document.getElementById('generate-route');
        const generateRouteButtonText = document.getElementById('generate-route-btn-text');
        const truckIdInput = document.getElementById('truck-id');
        const generateRouteMessageDiv = document.getElementById('generate-route-message');

        async function initialLoad() { /* ... same ... */ }
        async function fetchBinsAndRender() { /* ... same ... */ }
        async function fetchRoutesAndRender() { /* ... same ... */ }
        function renderBinsTable(binsToRender) { /* ... same ... */ }
        function renderRoutesTable(routesToRender) { /* ... same ... */ }
        function sortAndRenderBins() { /* ... same ... */ }
        function sortAndRenderRoutes() { /* ... same ... */ }
        function sortArray(array, key, direction) { /* ... same ... */ }
        function setupSortableTableHeaders() { /* ... same ... */ }
        function updateSortIndicators(tableContainerId, sortKey, sortDirection) { /* ... same ... */ }
        function displayMessage(element, message, type) { /* ... same ... */ }
        async function handleGenerateRoute() { /* ... same ... */ }

        // Re-paste the JS functions that were identical to save space in the diff if they were truly unchanged.
        // For this exercise, assume they are the same as the previous version unless explicitly mentioned.
        // The key changes were in the HTML classes for buttons and inputs.
        // The JS for DOMContentLoaded has a line added to remove opacity-0 from body.

        // (Paste the rest of the unchanged JS functions here from the previous version of waste_management/index.html)
        // ... (The JS code from the previous version of this file, as it was quite long)
        // --- Initialization, Data Fetching, Rendering, Sorting, Route Generation ---
        // All these functions would be here.
        // For the purpose of this diff, only the DOMContentLoaded listener was slightly modified.
        // The button classes were changed in HTML directly.
        // The input field class was changed in HTML directly.

        // (The following JS is a re-paste of the previous version, assuming no functional changes beyond what was specified)
        async function initialLoad() {
            await fetchBinsAndRender();
            await fetchRoutesAndRender();
        }

        async function fetchBinsAndRender() {
            binsLoadingDiv.style.display = 'block';
            binsTableBody.innerHTML = '';
            try {
                const response = await fetch('/bins');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                allBins = await response.json();
                sortAndRenderBins();
            } catch (error) {
                binsTableBody.innerHTML = `<tr><td colspan="7" class="p-4 text-center text-error">${errorIconSVG} Error fetching bins: ${error.message}</td></tr>`;
                console.error('Error fetching bins:', error);
            } finally {
                binsLoadingDiv.style.display = 'none';
            }
        }

        async function fetchRoutesAndRender() {
            routesLoadingDiv.style.display = 'block';
            routesTableBody.innerHTML = '';
            try {
                const response = await fetch('/routes');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                allRoutes = await response.json();
                sortAndRenderRoutes();
            } catch (error) {
                routesTableBody.innerHTML = `<tr><td colspan="7" class="p-4 text-center text-error">${errorIconSVG} Error fetching routes: ${error.message}</td></tr>`;
                console.error('Error fetching routes:', error);
            } finally {
                routesLoadingDiv.style.display = 'none';
            }
        }

        function renderBinsTable(binsToRender) {
            binsTableBody.innerHTML = '';
            if (binsToRender.length === 0) {
                binsTableBody.innerHTML = `<tr><td colspan="7" class="p-4 text-center text-secondary-dark">${emptyIconSVG}No bins found.</td></tr>`;
                return;
            }
            binsToRender.forEach(bin => {
                const row = binsTableBody.insertRow();
                row.className = 'even:bg-secondary-lightest hover:bg-primary/10 transition-colors duration-150';
                const fillPercentage = bin.capacity_gallons > 0 ? (bin.current_fill_level_gallons / bin.capacity_gallons) * 100 : 0;
                row.insertCell().textContent = bin.bin_id; row.cells[0].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = `(${bin.location.lat.toFixed(5)}, ${bin.location.lon.toFixed(5)})`; row.cells[1].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = bin.current_fill_level_gallons.toFixed(2); row.cells[2].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = bin.capacity_gallons.toFixed(2); row.cells[3].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                const percentageCell = row.insertCell(); percentageCell.className = 'p-3 border-b border-secondary-light text-secondary-dark whitespace-nowrap';
                const fillBarContainer = document.createElement('div'); fillBarContainer.className = 'inline-block w-24 h-4 bg-secondary-light rounded overflow-hidden mr-2 align-middle';
                const fillBar = document.createElement('div'); fillBar.className = 'h-full text-xs text-white text-center leading-tight';
                fillBar.style.width = `${Math.min(fillPercentage, 100)}%`;
                if (fillPercentage >= 90) fillBar.classList.add('bg-error');
                else if (fillPercentage >= 70) fillBar.classList.add('bg-warning');
                else fillBar.classList.add('bg-success');
                fillBarContainer.appendChild(fillBar); percentageCell.appendChild(fillBarContainer); percentageCell.append(`${fillPercentage.toFixed(1)}%`);
                row.insertCell().textContent = bin.status; row.cells[5].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = new Date(bin.last_updated).toLocaleString(); row.cells[6].className = 'p-3 border-b border-secondary-light text-secondary-dark whitespace-nowrap';
            });
        }

        function renderRoutesTable(routesToRender) {
            routesTableBody.innerHTML = '';
            if (routesToRender.length === 0) {
                routesTableBody.innerHTML = `<tr><td colspan="7" class="p-4 text-center text-secondary-dark">${emptyIconSVG}No routes found.</td></tr>`;
                return;
            }
            routesToRender.forEach(route => {
                const row = routesTableBody.insertRow(); row.className = 'even:bg-secondary-lightest hover:bg-primary/10 transition-colors duration-150';
                row.insertCell().textContent = route.route_id; row.cells[0].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = route.assigned_truck_id; row.cells[1].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = route.status; row.cells[2].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = route.bin_ids_to_collect.join(', '); row.cells[3].className = 'p-3 border-b border-secondary-light text-secondary-dark';
                row.insertCell().textContent = new Date(route.generated_at).toLocaleString(); row.cells[4].className = 'p-3 border-b border-secondary-light text-secondary-dark whitespace-nowrap';
                row.insertCell().textContent = route.started_at ? new Date(route.started_at).toLocaleString() : 'N/A'; row.cells[5].className = 'p-3 border-b border-secondary-light text-secondary-dark whitespace-nowrap';
                row.insertCell().textContent = route.completed_at ? new Date(route.completed_at).toLocaleString() : 'N/A'; row.cells[6].className = 'p-3 border-b border-secondary-light text-secondary-dark whitespace-nowrap';
            });
        }

        function sortAndRenderBins() { sortArray(allBins, currentBinSortKey, currentBinSortDirection); renderBinsTable(allBins); updateSortIndicators('bins-table-container', currentBinSortKey, currentBinSortDirection); }
        function sortAndRenderRoutes() { sortArray(allRoutes, currentRouteSortKey, currentRouteSortDirection); renderRoutesTable(allRoutes); updateSortIndicators('routes-table-container', currentRouteSortKey, currentRouteSortDirection); }

        function sortArray(array, key, direction) {
            array.sort((a, b) => {
                let valA = a[key]; let valB = b[key];
                if (key === 'fill_percentage') { valA = a.capacity_gallons > 0 ? (a.current_fill_level_gallons / a.capacity_gallons) * 100 : 0; valB = b.capacity_gallons > 0 ? (b.current_fill_level_gallons / b.capacity_gallons) * 100 : 0; }
                else if (key === 'last_updated' || key === 'generated_at') { valA = new Date(valA).getTime(); valB = new Date(valB).getTime(); }
                else if (typeof valA === 'string') { valA = valA.toLowerCase(); valB = valB.toLowerCase(); }
                if (valA < valB) return direction === 'asc' ? -1 : 1; if (valA > valB) return direction === 'asc' ? 1 : -1; return 0;
            });
        }
        function setupSortableTableHeaders() {
            document.querySelectorAll('#bins-table-container th[data-sort-key]').forEach(th => {
                th.addEventListener('click', () => { const key = th.dataset.sortKey; currentBinSortKey = key === currentBinSortKey ? (currentBinSortDirection === 'asc' ? 'desc' : 'asc') : 'asc'; sortAndRenderBins(); });
            });
            document.querySelectorAll('#routes-table-container th[data-sort-key]').forEach(th => {
                th.addEventListener('click', () => { const key = th.dataset.sortKey; currentRouteSortKey = key === currentRouteSortKey ? (currentRouteSortDirection === 'asc' ? 'desc' : 'asc') : 'asc'; sortAndRenderRoutes(); });
            });
        }
        function updateSortIndicators(tableContainerId, sortKey, sortDirection) {
            document.querySelectorAll(`#${tableContainerId} th[data-sort-key] .sort-indicator`).forEach(indicator => { const th = indicator.parentElement; indicator.textContent = th.dataset.sortKey === sortKey ? (sortDirection === 'asc' ? '▲' : '▼') : ''; });
        }
        function displayMessage(element, message, type) {
            element.innerHTML = ''; let icon = ''; let textClass = ''; let borderClass = ''; let bgClass = '';
            if (type === 'success') { icon = successIconSVG; textClass = 'text-success-dark'; borderClass = 'border-success'; bgClass = 'bg-success/10'; }
            else if (type === 'error') { icon = errorIconSVG; textClass = 'text-error-dark'; borderClass = 'border-error'; bgClass = 'bg-error/10'; }
            else { icon = infoIconSVG; textClass = 'text-info-dark'; borderClass = 'border-info'; bgClass = 'bg-info/10'; }
            element.innerHTML = `${icon} ${message}`; element.className = `p-4 rounded-md mt-4 text-sm ${textClass} ${borderClass} ${bgClass} border`; element.style.display = 'block';
        }
        async function handleGenerateRoute() {
            const truckId = truckIdInput.value.trim(); generateRouteMessageDiv.style.display = 'none';
            if (!truckId) { displayMessage(generateRouteMessageDiv, 'Truck ID cannot be empty.', 'error'); return; }
            generateRouteButton.disabled = true; const originalButtonHTML = generateRouteButtonText.innerHTML;
            generateRouteButtonText.innerHTML = `${loadingSpinnerSVG} Generating...`;
            try {
                const response = await fetch('/routes/generate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ assigned_truck_id: truckId }), });
                const result = await response.json();
                if (!response.ok) { throw new Error(result.error || `HTTP error! Status: ${response.status}`); }
                if (response.status === 201 && result.route_id) { displayMessage(generateRouteMessageDiv, `Route ${result.route_id} generated successfully for truck ${result.assigned_truck_id}. Bins: ${result.bin_ids_to_collect.join(', ')}.`, 'success'); }
                else if (response.status === 200 && result.message) { displayMessage(generateRouteMessageDiv, result.message, 'info'); }
                else { displayMessage(generateRouteMessageDiv, 'Route generation status unknown. Received unexpected response.', 'info'); }
                fetchRoutesAndRender(); fetchBinsAndRender();
            } catch (error) { displayMessage(generateRouteMessageDiv, `Error generating route: ${error.message}`, 'error'); console.error('Error generating route:', error);
            } finally { generateRouteButton.disabled = false; generateRouteButtonText.innerHTML = originalButtonHTML; }
        }
    </script>
</body>
</html>
